name: "01 - Issue -> Agent (create PR)"

on:
  issues:
    types: [opened]

permissions:
  contents: write
  pull-requests: write
  issues: read

concurrency:
  group: issue-${{ github.event.issue.number }}
  cancel-in-progress: false

jobs:
  debug-workspace:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository (issue-trigger)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Show workspace info
        run: |
          echo "github.workspace = ${{ github.workspace }}"
          echo "pwd = $(pwd)"
          echo "ls -la workspace:"
          ls -la "${{ github.workspace }}"
          echo
          echo "git status:"
          git status
          echo
          echo "git rev-parse:"
          git rev-parse --is-inside-work-tree
          git rev-parse HEAD

      # - name: Pull agent image
      #   run: docker pull ghcr.io/<OWNER>/<AGENT_IMAGE>:v0.1.0
      #
      # - name: Run Code Agent (create/update PR)
      #   env:
      #     GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      #     LLM_API_KEY: ${{ secrets.LLM_API_KEY }}
      #     REPO: ${{ github.repository }}
      #     ISSUE_NUMBER: ${{ github.event.issue.number }}
      #     BASE_BRANCH: ${{ github.event.repository.default_branch }}
      #   run: |
      #     docker run --rm \
      #       -e GH_TOKEN \
      #       -e LLM_API_KEY \
      #       -e REPO \
      #       -e ISSUE_NUMBER \
      #       -e BASE_BRANCH \
      #       -v "${{ github.workspace }}:/work" \
      #       -w /work \
      #       ghcr.io/<OWNER>/<AGENT_IMAGE>:v0.1.0 \
      #       agent code \
      #         --repo "$REPO" \
      #         --issue "$ISSUE_NUMBER" \
      #         --base "$BASE_BRANCH" \
      #         --max-iter 5
